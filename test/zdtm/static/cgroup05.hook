#!/bin/bash

[ "$1" == "--clean" -o "$1" == "--pre-restore" ] || exit 0

set -e

tname=$(mktemp -d cgclean.XXXXXX)
mount -t cgroup none $tname -o "none,name=zdtmtstxattr"

echo "Cleaning $tname"

set +e
setxattr -x trusted.zdtmtest "$tname/subcg/tasks"
rmdir "$tname/subcg/"
set -e

echo "Left there is:"
ls "$tname"
umount "$tname"
rmdir "$tname"
